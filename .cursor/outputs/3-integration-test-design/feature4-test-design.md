# 🧪 테스트 설계서: Feature 4 - 반복 일정 수정

## 1. 테스트 목적

반복 일정 수정 시 단일 수정과 전체 수정이 올바르게 동작하는지 검증합니다.
- 다이얼로그가 적절히 표시되고 사용자 선택을 처리하는지 확인
- 단일 수정 시 선택한 일정만 수정되고 반복 속성이 제거되는지 확인
- 전체 수정 시 모든 반복 일정이 수정되고 반복 속성이 유지되는지 확인
- 일반 일정 수정 시 다이얼로그가 표시되지 않는지 확인

## 2. 테스트 범위

### 포함
- 반복 일정 수정 시 다이얼로그 표시 및 선택 처리
- 단일 수정 모드: 선택한 일정만 수정, 반복 속성 제거
- 전체 수정 모드: 모든 반복 일정 수정, 반복 속성 유지
- 반복 아이콘 표시/숨김 변화
- 일반 일정 수정 시 다이얼로그 미표시

### 제외
- 반복 일정 생성 로직 (Feature 1에서 검증)
- 반복 일정 시각적 구분 (Feature 2에서 검증)
- 반복 일정 종료 날짜 (Feature 3에서 검증)
- 백엔드 API 실제 통신 (MSW로 모킹)

## 3. 테스트 분류

| 구분        | 설명                                        |
| ----------- | ------------------------------------------- |
| 통합 테스트 | UI 다이얼로그와 비즈니스 로직 간 상호작용  |
| 단위 테스트 | 반복 그룹 식별, 일괄 수정 로직 등 순수 함수 |

## 4. 테스트 시나리오

### Story 1: 단일 반복 일정 수정

| TC ID | 설명 | 입력 | 사용자 행동 | 기대 결과 | 테스트 유형 |
|-------|------|------|-------------|-----------|-------------|
| TC-4-1-1 | 단일 수정 선택 시 해당 일정만 수정되고 반복 속성이 제거된다 | - 반복 일정 (매주 월요일) 존재<br>- ID: "repeat-1"<br>- 제목: "팀 미팅" | 1. 반복 일정 클릭<br>2. 수정 버튼 클릭<br>3. 다이얼로그에서 "예" 버튼 클릭<br>4. 제목을 "개인 미팅"으로 변경<br>5. 저장 버튼 클릭 | - API PUT /api/events/repeat-1 호출<br>- body.repeat.type = 'none'<br>- body.title = "개인 미팅"<br>- 다른 반복 일정은 변경 없음 | 통합 |
| TC-4-1-2 | 단일 수정 후 해당 일정의 반복 아이콘이 사라진다 | - 단일 수정 완료된 일정 | 1. 일정 목록 확인 | - 수정된 일정에 반복 아이콘 없음<br>- queryByLabelText('반복 일정') 결과 null | 통합 |
| TC-4-1-3 | 단일 수정 시 나머지 반복 일정은 유지된다 | - 매주 수요일 반복 일정 4개<br>- 두 번째 일정 ID: "repeat-2" | 1. 두 번째 일정 클릭<br>2. 수정 버튼 클릭<br>3. "예" 선택<br>4. 시간 변경<br>5. 저장 | - 두 번째 일정만 PUT 호출<br>- 나머지 3개 일정은 API 호출 없음<br>- 나머지 3개는 반복 아이콘 유지 | 통합 |

### Story 2: 전체 반복 일정 수정

| TC ID | 설명 | 입력 | 사용자 행동 | 기대 결과 | 테스트 유형 |
|-------|------|------|-------------|-----------|-------------|
| TC-4-2-1 | 전체 수정 선택 시 모든 반복 일정이 수정되고 반복 속성이 유지된다 | - 매주 화요일 반복 일정 3개<br>- IDs: ["repeat-a", "repeat-b", "repeat-c"]<br>- 제목: "운동" | 1. 첫 번째 일정 클릭<br>2. 수정 버튼 클릭<br>3. 다이얼로그에서 "아니오" 버튼 클릭<br>4. 제목을 "헬스"로 변경<br>5. 저장 버튼 클릭 | - API PUT 호출 3번 (각 ID마다)<br>- 모든 body.repeat.type = 'weekly' 유지<br>- 모든 body.title = "헬스" | 통합 |
| TC-4-2-2 | 전체 수정 후 모든 일정의 반복 아이콘이 유지된다 | - 전체 수정 완료된 반복 일정들 | 1. 일정 목록 확인 | - 모든 일정에 반복 아이콘 표시<br>- getAllByLabelText('반복 일정') 개수 = 반복 일정 개수 | 통합 |
| TC-4-2-3 | 전체 수정 시 반복 유형이 유지된다 | - 매월 1일 반복 일정 2개<br>- repeat.type = 'monthly' | 1. 첫 번째 일정 수정<br>2. "아니오" 선택<br>3. 시간만 변경<br>4. 저장 | - 모든 API 호출 body.repeat.type = 'monthly'<br>- 모든 일정의 시간이 변경됨 | 통합 |

### Story 3: 수정 확인 다이얼로그 표시

| TC ID | 설명 | 입력 | 사용자 행동 | 기대 결과 | 테스트 유형 |
|-------|------|------|-------------|-----------|-------------|
| TC-4-3-1 | 반복 일정 수정 시 다이얼로그가 표시된다 | - 반복 일정 (매일) 존재 | 1. 반복 일정 클릭<br>2. 수정 버튼 클릭 | - 다이얼로그 표시됨<br>- "해당 일정만 수정하시겠어요?" 텍스트 존재<br>- "예" 버튼 존재<br>- "아니오" 버튼 존재 | 통합 |
| TC-4-3-2 | 다이얼로그에서 "예" 선택 시 단일 수정 모드로 진행된다 | - 다이얼로그 표시 상태 | 1. "예" 버튼 클릭 | - 다이얼로그 닫힘<br>- 일정 수정 폼 표시<br>- (이후 저장 시 단일 수정 동작 - TC-4-1-1에서 검증) | 통합 |
| TC-4-3-3 | 다이얼로그에서 "아니오" 선택 시 전체 수정 모드로 진행된다 | - 다이얼로그 표시 상태 | 1. "아니오" 버튼 클릭 | - 다이얼로그 닫힘<br>- 일정 수정 폼 표시<br>- (이후 저장 시 전체 수정 동작 - TC-4-2-1에서 검증) | 통합 |
| TC-4-3-4 | 일반 일정 수정 시 다이얼로그가 표시되지 않는다 | - 일반 일정 (repeat.type = 'none') 존재 | 1. 일반 일정 클릭<br>2. 수정 버튼 클릭 | - 다이얼로그 표시되지 않음<br>- 바로 일정 수정 폼 표시<br>- queryByText("해당 일정만 수정하시겠어요?") = null | 통합 |

## 5. 테스트 데이터

### Mock Repeating Events (Group)
```typescript
const mockRepeatingEvents: Event[] = [
  {
    id: 'repeat-mon-1',
    title: '팀 미팅',
    date: '2025-10-06', // 월요일
    startTime: '10:00',
    endTime: '11:00',
    description: '주간 팀 미팅',
    location: '회의실',
    category: '업무',
    repeat: { type: 'weekly', interval: 1 },
    notificationTime: 10,
  },
  {
    id: 'repeat-mon-2',
    title: '팀 미팅',
    date: '2025-10-13', // 다음 주 월요일
    startTime: '10:00',
    endTime: '11:00',
    description: '주간 팀 미팅',
    location: '회의실',
    category: '업무',
    repeat: { type: 'weekly', interval: 1 },
    notificationTime: 10,
  },
  {
    id: 'repeat-mon-3',
    title: '팀 미팅',
    date: '2025-10-20', // 다다음 주 월요일
    startTime: '10:00',
    endTime: '11:00',
    description: '주간 팀 미팅',
    location: '회의실',
    category: '업무',
    repeat: { type: 'weekly', interval: 1 },
    notificationTime: 10,
  },
];

const mockNormalEvent: Event = {
  id: 'normal-1',
  title: '일반 회의',
  date: '2025-10-07',
  startTime: '14:00',
  endTime: '15:00',
  description: '일반 일정',
  location: '사무실',
  category: '업무',
  repeat: { type: 'none', interval: 1 },
  notificationTime: 10,
};
```

## 6. 검증 기준 (Assertion Points)

### UI 검증
- [ ] 반복 일정 수정 시 다이얼로그 표시
- [ ] 다이얼로그에 "해당 일정만 수정하시겠어요?" 텍스트 존재
- [ ] "예", "아니오" 버튼 존재
- [ ] 일반 일정 수정 시 다이얼로그 미표시
- [ ] 단일 수정 후 반복 아이콘 사라짐
- [ ] 전체 수정 후 반복 아이콘 유지

### 데이터 검증
- [ ] 단일 수정 시 `repeat.type = 'none'`으로 변경
- [ ] 전체 수정 시 `repeat.type` 유지
- [ ] 단일 수정 시 1개 API 호출
- [ ] 전체 수정 시 N개 API 호출 (반복 일정 개수만큼)

### API 호출 검증
- [ ] 단일 수정: PUT /api/events/{id} 1회
- [ ] 전체 수정: PUT /api/events/{id} N회 (각 반복 일정마다)
- [ ] 각 요청 body에 수정된 속성 포함
- [ ] 단일 수정 시 repeat.type = 'none' 포함

## 7. 엣지 케이스 및 경계값

| 케이스 | 입력값 | 기대 동작 |
|--------|--------|-----------|
| 반복 일정 1개만 존재 | 단일 반복 일정 | 단일/전체 수정 동일 결과 |
| 매우 많은 반복 일정 (100개) | 전체 수정 선택 | 100번 API 호출 (또는 일괄 수정 API) |
| 다이얼로그에서 취소 (ESC) | ESC 키 입력 | 다이얼로그 닫힘, 수정 취소 |
| 제목이 같지만 다른 반복 일정 | 다른 그룹의 같은 제목 | 해당 그룹만 수정 |

## 8. 비고

### 확인 필요 사항
- ⚠️ **반복 그룹 식별 방법**: 제목 + 시작시간 + 반복유형 + 간격으로 식별? 또는 별도 groupId?
- ⚠️ **전체 수정 API**: 개별 PUT N번 vs 일괄 PUT 1번 (body에 배열)?
- ⚠️ **다이얼로그 UI**: MUI Dialog 사용, 버튼 위치/스타일
- ⚠️ **수정 폼 재사용**: 기존 수정 폼 재사용 가능한지

### 구현 시 고려사항
- 반복 그룹 식별 로직: `src/utils/repeatGroupUtils.ts` 신규 생성
- 단일/전체 수정 모드 상태 관리: `useState` 또는 context
- 다이얼로그 컴포넌트: App.tsx에 추가 또는 별도 컴포넌트
- API 호출 최적화: 전체 수정 시 일괄 처리 고려

### 테스트 코드 구조 제안
```typescript
describe('FEATURE4: 반복 일정 수정', () => {
  describe('Story 1: 단일 반복 일정 수정', () => {
    it('TC-4-1-1: 단일 수정 선택 시 해당 일정만 수정되고 반복 속성이 제거된다', ...);
    it('TC-4-1-2: 단일 수정 후 해당 일정의 반복 아이콘이 사라진다', ...);
    it('TC-4-1-3: 단일 수정 시 나머지 반복 일정은 유지된다', ...);
  });
  
  describe('Story 2: 전체 반복 일정 수정', () => {
    it('TC-4-2-1: 전체 수정 선택 시 모든 반복 일정이 수정되고 반복 속성이 유지된다', ...);
    it('TC-4-2-2: 전체 수정 후 모든 일정의 반복 아이콘이 유지된다', ...);
    it('TC-4-2-3: 전체 수정 시 반복 유형이 유지된다', ...);
  });
  
  describe('Story 3: 수정 확인 다이얼로그 표시', () => {
    it('TC-4-3-1: 반복 일정 수정 시 다이얼로그가 표시된다', ...);
    it('TC-4-3-2: 다이얼로그에서 "예" 선택 시 단일 수정 모드로 진행된다', ...);
    it('TC-4-3-3: 다이얼로그에서 "아니오" 선택 시 전체 수정 모드로 진행된다', ...);
    it('TC-4-3-4: 일반 일정 수정 시 다이얼로그가 표시되지 않는다', ...);
  });
});
```

---

**테스트 설계 완료일**: 2025-10-30  
**총 테스트 케이스**: 10개 (Story 1: 3개, Story 2: 3개, Story 3: 4개)  
**테스트 유형**: 통합 테스트 10개
