# 🧪 테스트 설계서: Feature 5 - 반복 일정 삭제

## 1. 테스트 목적

반복 일정 삭제 시 단일 삭제와 전체 삭제가 올바르게 동작하는지 검증합니다.

- 다이얼로그가 적절히 표시되고 사용자 선택을 처리하는지 확인
- 단일 삭제 시 선택한 일정만 삭제되고 나머지는 유지되는지 확인
- 전체 삭제 시 모든 반복 일정이 삭제되는지 확인
- 일반 일정 삭제 시 다이얼로그가 표시되지 않는지 확인

## 2. 테스트 범위

### 포함

- 반복 일정 삭제 시 다이얼로그 표시 및 선택 처리
- 단일 삭제 모드: 선택한 일정만 삭제, 나머지 유지
- 전체 삭제 모드: 모든 반복 일정 삭제
- 일반 일정 삭제 시 다이얼로그 미표시 및 즉시 삭제

### 제외

- 반복 일정 생성 로직 (Feature 1에서 검증)
- 반복 일정 시각적 구분 (Feature 2에서 검증)
- 반복 일정 종료 날짜 (Feature 3에서 검증)
- 반복 일정 수정 (Feature 4에서 검증)
- 백엔드 API 실제 통신 (MSW로 모킹)

## 3. 테스트 분류

| 구분        | 설명                                        |
| ----------- | ------------------------------------------- |
| 통합 테스트 | UI 다이얼로그와 비즈니스 로직 간 상호작용   |
| 단위 테스트 | 반복 그룹 식별 로직 등 순수 함수 (Feature 4에서 구현됨) |

## 4. 테스트 시나리오

### Story 1: 반복 일정 삭제 모드 선택

| TC ID    | 설명                                              | 입력                                    | 사용자 행동                            | 기대 결과                                                                                                      | 테스트 유형 |
| -------- | ------------------------------------------------- | --------------------------------------- | -------------------------------------- | -------------------------------------------------------------------------------------------------------------- | ----------- |
| TC-5-1-1 | 반복 일정 삭제 클릭 시 확인 다이얼로그가 표시된다 | - 반복 일정 (매주 월요일) 존재          | 1. 반복 일정 클릭<br>2. 삭제 버튼 클릭 | - 다이얼로그 표시됨<br>- "해당 일정만 삭제하시겠어요?" 텍스트 존재<br>- "예" 버튼 존재<br>- "아니오" 버튼 존재 | 통합        |
| TC-5-1-2 | 일반 일정 삭제 시 다이얼로그 없이 즉시 삭제된다   | - 일반 일정 (repeat.type = 'none') 존재 | 1. 일반 일정 클릭<br>2. 삭제 버튼 클릭 | - 다이얼로그 표시되지 않음<br>- 즉시 DELETE API 호출<br>- "일정이 삭제되었습니다" 스낵바 표시                  | 통합        |

### Story 2: 단일 일정 삭제

| TC ID    | 설명                                           | 입력                                                                                   | 사용자 행동                                                        | 기대 결과                                                                                                                   | 테스트 유형 |
| -------- | ---------------------------------------------- | -------------------------------------------------------------------------------------- | ------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------- | ----------- |
| TC-5-2-1 | 다이얼로그에서 '예' 선택 시 해당 일정만 삭제된다 | - 반복 일정 3개 존재 (매주 월요일)<br>- IDs: ["repeat-1", "repeat-2", "repeat-3"]<br>- 제목: "회의" | 1. 두 번째 일정(repeat-2) 클릭<br>2. 삭제 버튼 클릭<br>3. "예" 버튼 클릭 | - DELETE /api/events/repeat-2 호출<br>- DELETE 호출 횟수 = 1<br>- "일정이 삭제되었습니다" 스낵바 표시                      | 통합        |
| TC-5-2-2 | 단일 삭제 후 삭제 성공 메시지가 표시된다       | - 단일 삭제 완료                                                                       | 1. 삭제 완료 후 대기                                               | - "일정이 삭제되었습니다" 텍스트 스낵바 표시<br>- getByText("일정이 삭제되었습니다") 존재                                   | 통합        |
| TC-5-2-3 | 단일 삭제 후 캘린더에서 해당 일정만 사라진다   | - 매주 목요일 반복 일정 3개<br>- 제목: "운동"                                          | 1. 첫 번째 일정 삭제 (단일 삭제)<br>2. 캘린더 확인                 | - "운동" 텍스트가 2개만 표시됨<br>- getAllByText("운동").length = 2 (또는 반복 아이콘 기준으로 카운트 = 2)                 | 통합        |

### Story 3: 전체 반복 일정 삭제

| TC ID    | 설명                                                  | 입력                                                                                   | 사용자 행동                                                                | 기대 결과                                                                                                                   | 테스트 유형 |
| -------- | ----------------------------------------------------- | -------------------------------------------------------------------------------------- | -------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------- | ----------- |
| TC-5-3-1 | 다이얼로그에서 '아니오' 선택 시 전체 반복 일정이 삭제된다 | - 반복 일정 3개 존재 (매주 수요일)<br>- IDs: ["repeat-a", "repeat-b", "repeat-c"]<br>- 제목: "스터디" | 1. 첫 번째 일정(repeat-a) 클릭<br>2. 삭제 버튼 클릭<br>3. "아니오" 버튼 클릭 | - DELETE /api/events/{id} 호출 3번 (각 ID마다)<br>- 또는 DELETE /api/events-list 호출 1번<br>- "일정이 삭제되었습니다" 스낵바 표시 | 통합        |
| TC-5-3-2 | 전체 삭제 후 삭제 성공 메시지가 표시된다              | - 전체 삭제 완료                                                                       | 1. 삭제 완료 후 대기                                                       | - "일정이 삭제되었습니다" 텍스트 스낵바 표시<br>- getByText("일정이 삭제되었습니다") 존재                                   | 통합        |
| TC-5-3-3 | 전체 삭제 후 캘린더에서 모든 반복 일정이 사라진다     | - 매주 금요일 반복 일정 4개<br>- 제목: "미팅"                                          | 1. 아무 일정 선택하여 전체 삭제<br>2. 캘린더 확인                          | - "미팅" 텍스트가 캘린더에서 완전히 사라짐<br>- queryByText("미팅") = null                                                  | 통합        |

## 5. 테스트 데이터

### Mock Repeating Events (For Deletion)

```typescript
const mockRepeatingEventsForDeletion: Event[] = [
  {
    id: 'repeat-del-1',
    title: '회의',
    date: '2025-10-06', // 월요일
    startTime: '10:00',
    endTime: '11:00',
    description: '주간 회의',
    location: '회의실',
    category: '업무',
    repeat: { type: 'weekly', interval: 1 },
    notificationTime: 10,
  },
  {
    id: 'repeat-del-2',
    title: '회의',
    date: '2025-10-13', // 월요일 (1주 후)
    startTime: '10:00',
    endTime: '11:00',
    description: '주간 회의',
    location: '회의실',
    category: '업무',
    repeat: { type: 'weekly', interval: 1 },
    notificationTime: 10,
  },
  {
    id: 'repeat-del-3',
    title: '회의',
    date: '2025-10-20', // 월요일 (2주 후)
    startTime: '10:00',
    endTime: '11:00',
    description: '주간 회의',
    location: '회의실',
    category: '업무',
    repeat: { type: 'weekly', interval: 1 },
    notificationTime: 10,
  },
];

const mockNormalEventForDeletion: Event = {
  id: 'normal-del-1',
  title: '일반 일정',
  date: '2025-10-07',
  startTime: '14:00',
  endTime: '15:00',
  description: '일반 일정 설명',
  location: '장소',
  category: '개인',
  repeat: { type: 'none', interval: 0 },
  notificationTime: 10,
};
```

### Mock API Responses

```typescript
// Single deletion: DELETE /api/events/:id
const mockDeleteSingleResponse = {
  status: 200,
  body: { success: true },
};

// Group deletion: DELETE /api/events-list (optional, depends on backend design)
const mockDeleteGroupResponse = {
  status: 200,
  body: { success: true, deletedCount: 3 },
};
```

## 6. 검증 포인트

### Story 1: 반복 일정 삭제 모드 선택

| TC ID    | 검증 항목                                   | 검증 방법                                                   |
| -------- | ------------------------------------------- | ----------------------------------------------------------- |
| TC-5-1-1 | 다이얼로그 표시                             | `getByText("해당 일정만 삭제하시겠어요?")`                  |
|          | "예" 버튼 존재                              | `getByRole('button', { name: '예' })`                       |
|          | "아니오" 버튼 존재                          | `getByRole('button', { name: '아니오' })`                   |
| TC-5-1-2 | 다이얼로그 미표시                           | `queryByText("해당 일정만 삭제하시겠어요?")` = null         |
|          | DELETE API 즉시 호출                        | MSW handler 또는 mockFetch 검증                             |
|          | 스낵바 메시지 표시                          | `getByText("일정이 삭제되었습니다")`                        |

### Story 2: 단일 일정 삭제

| TC ID    | 검증 항목                                   | 검증 방법                                                   |
| -------- | ------------------------------------------- | ----------------------------------------------------------- |
| TC-5-2-1 | DELETE API 호출 횟수 = 1                    | `mockFetch.mock.calls.filter(call => call[0].includes('/api/events/') && call[1]?.method === 'DELETE').length` = 1 |
|          | DELETE URL에 특정 ID 포함                   | `mockFetch.mock.calls.find(call => call[0].includes('/api/events/repeat-2'))` 존재 |
|          | 스낵바 메시지 표시                          | `getByText("일정이 삭제되었습니다")`                        |
| TC-5-2-2 | 스낵바 메시지 표시                          | `getByText("일정이 삭제되었습니다")`                        |
| TC-5-2-3 | 캘린더에 특정 이벤트만 제거됨               | `getAllByText("운동").length` = 2 (이전 3개에서 1개 삭제)   |
|          | 또는 반복 아이콘 개수                       | `getAllByLabelText("반복 일정").length` = 2                 |

### Story 3: 전체 반복 일정 삭제

| TC ID    | 검증 항목                                   | 검증 방법                                                   |
| -------- | ------------------------------------------- | ----------------------------------------------------------- |
| TC-5-3-1 | DELETE API 호출 횟수 = 그룹 내 이벤트 개수 | `mockFetch.mock.calls.filter(call => call[1]?.method === 'DELETE').length` = 3 |
|          | 모든 ID에 대해 DELETE 호출                  | repeat-a, repeat-b, repeat-c 각각 호출 확인                 |
|          | 스낵바 메시지 표시                          | `getByText("일정이 삭제되었습니다")`                        |
| TC-5-3-2 | 스낵바 메시지 표시                          | `getByText("일정이 삭제되었습니다")`                        |
| TC-5-3-3 | 캘린더에서 모든 반복 일정 제거됨            | `queryByText("미팅")` = null                                |
|          | 또는 반복 아이콘이 완전히 사라짐            | `queryAllByLabelText("반복 일정").length` = 0 (해당 그룹 기준) |

## 7. 테스트 구조

```typescript
describe('Feature 5: 반복 일정 삭제', () => {
  beforeEach(() => {
    // MSW 설정
    server.use(
      http.get('/api/events', () => {
        return HttpResponse.json({ events: mockRepeatingEventsForDeletion });
      }),
      http.delete('/api/events/:id', ({ params }) => {
        return HttpResponse.json({ success: true });
      })
    );
  });

  describe('Story 1: 반복 일정 삭제 모드 선택', () => {
    it('TC-5-1-1: 반복 일정 삭제 클릭 시 확인 다이얼로그가 표시된다', async () => {
      // ...
    });

    it('TC-5-1-2: 일반 일정 삭제 시 다이얼로그 없이 즉시 삭제된다', async () => {
      // ...
    });
  });

  describe('Story 2: 단일 일정 삭제', () => {
    it('TC-5-2-1: 다이얼로그에서 "예" 선택 시 해당 일정만 삭제된다', async () => {
      // ...
    });

    it('TC-5-2-2: 단일 삭제 후 삭제 성공 메시지가 표시된다', async () => {
      // ...
    });

    it('TC-5-2-3: 단일 삭제 후 캘린더에서 해당 일정만 사라진다', async () => {
      // ...
    });
  });

  describe('Story 3: 전체 반복 일정 삭제', () => {
    it('TC-5-3-1: 다이얼로그에서 "아니오" 선택 시 전체 반복 일정이 삭제된다', async () => {
      // ...
    });

    it('TC-5-3-2: 전체 삭제 후 삭제 성공 메시지가 표시된다', async () => {
      // ...
    });

    it('TC-5-3-3: 전체 삭제 후 캘린더에서 모든 반복 일정이 사라진다', async () => {
      // ...
    });
  });
});
```

## 8. 주의사항

1. **반복 그룹 식별**: Feature 4에서 구현된 `findRepeatGroup` 함수를 재사용할 수 있습니다.
2. **다이얼로그 조건**: `repeat.type !== 'none'`인 경우에만 다이얼로그를 표시해야 합니다.
3. **삭제 API 설계**:
   - 단일 삭제: `DELETE /api/events/{id}`
   - 전체 삭제: 각 ID마다 개별 DELETE 호출 또는 `DELETE /api/events-list` (백엔드 구현에 따라 결정)
4. **MSW 모킹**: 테스트 중 실제 API 호출을 방지하기 위해 MSW를 사용합니다.
5. **스낵바 검증**: `waitFor`를 사용하여 스낵바 메시지가 표시될 때까지 대기해야 합니다.
6. **캘린더 렌더링**: 삭제 후 `fetchEvents()`가 호출되고 캘린더가 리렌더링되는지 확인해야 합니다.

## 9. 선행 조건

- Feature 4 (반복 일정 수정)의 `findRepeatGroup` 유틸리티가 구현되어 있어야 합니다.
- 삭제 버튼이 UI에 존재하고 클릭 가능해야 합니다.
- MSW가 설정되어 있어야 합니다.

## 10. 성공 기준

- ✅ 모든 8개 테스트 케이스가 통과합니다.
- ✅ Linter 에러가 없습니다.
- ✅ 테스트 커버리지가 90% 이상입니다.
- ✅ Integration Test Evaluator 점수가 90점 이상입니다.
