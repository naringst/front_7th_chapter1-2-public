# 🧪 테스트 설계서: Feature 3 - 반복 일정 종료 조건

## 1. 테스트 목적

반복 일정의 종료 조건 설정 기능이 올바르게 동작하는지 검증합니다.
- 사용자가 종료 날짜를 설정하면 해당 날짜까지만 반복 일정이 생성됨
- 종료 날짜 미입력 시 기본값(2025-12-31)이 적용됨
- 잘못된 종료 날짜 입력 시 적절한 검증이 수행됨
- 종료 날짜 수정 기능이 정상 작동함

## 2. 테스트 범위

### 포함
- 반복 유형 선택 시 종료 날짜 입력 필드 표시
- 종료 날짜 입력 및 저장 기능
- 종료 날짜 기본값(2025-12-31) 적용
- 종료 날짜 검증 (시작 날짜보다 이전, 최대값 초과)
- 종료 날짜에 따른 반복 일정 생성 제한
- 반복 일정 수정 시 종료 날짜 표시 및 수정
- UI에서 종료 날짜 정보 표시

### 제외
- 반복 일정의 기본 생성 로직 (Feature 1에서 검증)
- 반복 일정의 시각적 구분 (Feature 2에서 검증)
- 백엔드 API 실제 통신 (MSW로 모킹)

## 3. 테스트 분류

| 구분        | 설명                                      |
| ----------- | ----------------------------------------- |
| 통합 테스트 | UI 컴포넌트와 비즈니스 로직 간 상호작용   |
| 단위 테스트 | 날짜 검증, 반복 생성 로직 등 순수 함수   |

## 4. 테스트 시나리오

### Story 1: 반복 종료 조건 설정

| TC ID   | 설명 | 입력 | 사용자 행동 | 기대 결과 | 테스트 유형 |
|---------|------|------|-------------|-----------|-------------|
| TC-3-1-1 | 반복 유형 선택 시 종료 날짜 입력 필드가 표시된다 | 반복 유형: "매일" 선택 | 1. 일정 추가 폼 열기<br>2. 반복 유형 드롭다운에서 "매일" 선택 | 종료 날짜 입력 필드가 화면에 표시됨 | 통합 |
| TC-3-1-2 | 반복 유형 "반복 안함" 선택 시 종료 날짜 필드가 숨겨진다 | 반복 유형: "반복 안함" 선택 | 1. 일정 추가 폼 열기<br>2. 반복 유형 드롭다운에서 "반복 안함" 선택 | 종료 날짜 입력 필드가 화면에서 숨겨짐 | 통합 |
| TC-3-1-3 | 종료 날짜를 입력하고 저장하면 해당 날짜까지만 반복 일정이 생성된다 | - 제목: "매일 회의"<br>- 시작 날짜: 2025-10-01<br>- 반복: 매일<br>- 종료: 2025-10-05 | 1. 일정 추가 폼에 입력<br>2. 저장 버튼 클릭 | - API 호출: POST /api/events-list<br>- 생성된 일정: 5개 (10/1~10/5)<br>- 각 일정의 날짜가 2025-10-01부터 2025-10-05까지 | 통합 |
| TC-3-1-4 | 종료 날짜 미입력 시 기본값(2025-12-31)까지 생성된다 | - 제목: "매주 회의"<br>- 시작 날짜: 2025-10-01<br>- 반복: 매주<br>- 종료: (비어있음) | 1. 일정 추가 폼에 입력 (종료 날짜 제외)<br>2. 저장 버튼 클릭 | - API 호출: POST /api/events-list<br>- 생성된 일정의 마지막 날짜가 2025-12-31 이전<br>- 2026-01-01 이후 일정은 생성되지 않음 | 통합 |

### Story 2: 반복 종료 조건 검증

| TC ID   | 설명 | 입력 | 사용자 행동 | 기대 결과 | 테스트 유형 |
|---------|------|------|-------------|-----------|-------------|
| TC-3-2-1 | 종료 날짜가 시작 날짜보다 이전이면 에러 메시지가 표시된다 | - 시작 날짜: 2025-10-15<br>- 반복: 매일<br>- 종료: 2025-10-10 | 1. 일정 추가 폼에 입력<br>2. 저장 버튼 클릭 | - 일정이 저장되지 않음<br>- 에러 메시지 표시: "종료 날짜는 시작 날짜 이후여야 합니다"<br>- API 호출 없음 | 통합 |
| TC-3-2-2 | 반복 일정이 종료 날짜 다음날부터는 생성되지 않는다 | - 시작: 2025-10-01<br>- 반복: 매일<br>- 종료: 2025-10-10 | 1. 일정 추가 폼에 입력<br>2. 저장 버튼 클릭<br>3. 생성된 일정 확인 | - 생성된 일정: 정확히 10개<br>- 마지막 일정 날짜: 2025-10-10<br>- 2025-10-11 일정은 생성되지 않음 | 통합 |
| TC-3-2-3 | 종료 날짜가 2025-12-31을 초과하면 2025-12-31까지만 생성된다 | - 시작: 2025-12-01<br>- 반복: 매일<br>- 종료: 2026-01-31 | 1. 일정 추가 폼에 입력<br>2. 저장 버튼 클릭<br>3. 생성된 일정 확인 | - 마지막 일정 날짜: 2025-12-31<br>- 2026-01-01 이후 일정은 생성되지 않음<br>- 총 31개 일정 생성 (12/1~12/31) | 통합 |

### Story 3: 종료 날짜 수정 및 표시

| TC ID   | 설명 | 입력 | 사용자 행동 | 기대 결과 | 테스트 유형 |
|---------|------|------|-------------|-----------|-------------|
| TC-3-3-1 | 반복 일정 수정 시 기존 종료 날짜가 입력 필드에 표시된다 | 기존 일정:<br>- 반복: 매주<br>- 종료: 2025-10-31 | 1. 반복 일정 클릭<br>2. 수정 버튼 클릭 | - 일정 수정 폼이 열림<br>- 종료 날짜 필드에 "2025-10-31" 표시 | 통합 |
| TC-3-3-2 | 종료 날짜를 수정하면 새로운 종료 날짜가 반영된다 | - 기존 종료: 2025-10-31<br>- 수정 종료: 2025-11-30 | 1. 반복 일정 수정 폼 열기<br>2. 종료 날짜를 2025-11-30으로 변경<br>3. 저장 버튼 클릭 | - API 호출: PUT /api/events/{id}<br>- 수정된 일정의 종료 날짜가 2025-11-30으로 업데이트됨 | 통합 |
| TC-3-3-3 | 일정 목록에서 반복 일정의 종료 날짜 정보가 표시된다 | 반복 일정:<br>- 제목: "매주 회의"<br>- 종료: 2025-12-31 | 1. 캘린더 또는 일정 목록 확인 | - 일정 제목 옆 또는 아래에 "2025-12-31까지" 텍스트 표시<br>- 또는 "~까지 반복" 형태의 안내 문구 표시 | 통합 |

## 5. 테스트 데이터

### Mock Events
```typescript
// 종료 날짜가 있는 반복 일정
const repeatingEventWithEnd: Event = {
  id: 'repeat-with-end-1',
  title: '매주 회의',
  date: '2025-10-01',
  startTime: '10:00',
  endTime: '11:00',
  description: '종료 날짜가 있는 반복 일정',
  location: '회의실',
  category: '업무',
  repeat: { 
    type: 'weekly', 
    interval: 1,
    endDate: '2025-10-31'  // 종료 날짜
  },
  notificationTime: 10,
};

// 종료 날짜가 없는 반복 일정 (기본값 적용)
const repeatingEventNoEnd: Event = {
  id: 'repeat-no-end-1',
  title: '매일 운동',
  date: '2025-10-01',
  startTime: '07:00',
  endTime: '08:00',
  description: '종료 날짜 없음',
  location: '헬스장',
  category: '개인',
  repeat: { 
    type: 'daily', 
    interval: 1,
    endDate: undefined  // 기본값 2025-12-31 적용
  },
  notificationTime: 10,
};
```

## 6. 검증 기준 (Assertion Points)

### UI 검증
- [ ] 반복 유형 선택 시 종료 날짜 필드 표시/숨김
- [ ] 종료 날짜 입력 필드가 date 타입 input으로 표시
- [ ] 에러 메시지가 사용자에게 명확히 표시
- [ ] 일정 수정 시 기존 종료 날짜가 pre-filled
- [ ] 일정 목록에서 종료 날짜 정보 표시

### 데이터 검증
- [ ] 종료 날짜가 없으면 2025-12-31로 기본 설정
- [ ] 종료 날짜가 시작 날짜보다 이전이면 저장 차단
- [ ] 종료 날짜가 2025-12-31을 초과하면 2025-12-31로 제한
- [ ] 생성된 반복 일정의 개수가 정확함
- [ ] 종료 날짜 다음날 일정은 생성되지 않음

### API 호출 검증
- [ ] POST /api/events-list에 올바른 이벤트 배열 전달
- [ ] PUT /api/events/{id}에 수정된 종료 날짜 포함
- [ ] 에러 발생 시 API 호출 없음

## 7. 엣지 케이스 및 경계값

| 케이스 | 입력값 | 기대 동작 |
|--------|--------|-----------|
| 종료 날짜 = 시작 날짜 | 시작: 2025-10-15, 종료: 2025-10-15 | 1개 일정만 생성 |
| 종료 날짜 = 시작 날짜 - 1 | 시작: 2025-10-15, 종료: 2025-10-14 | 에러 발생, 저장 차단 |
| 종료 날짜 = 2025-12-31 | 반복: 매일, 종료: 2025-12-31 | 2025-12-31까지 생성 |
| 종료 날짜 = 2025-12-31 + 1 | 반복: 매일, 종료: 2026-01-01 | 2025-12-31까지만 생성 (제한) |
| 종료 날짜 = null/undefined | 반복: 매주 | 2025-12-31까지 생성 (기본값) |
| 윤년 + 종료 날짜 | 시작: 2024-02-28, 종료: 2024-02-29, 매일 | 2개 일정 생성 (28, 29일) |

## 8. 비고

### 확인 필요 사항
- ✅ 종료 날짜 기본값: 2025-12-31 (PRD 명시)
- ✅ 종료 날짜 최대값: 2025-12-31 (PRD 명시)
- ⚠️ UI 표시 형식: "2025-12-31까지" vs "~까지 반복" (사용자 확인 필요)
- ⚠️ 종료 날짜 수정 시 기존 생성된 일정 처리 방법 (삭제 후 재생성? 추가 생성?)

### 구현 시 고려사항
- 종료 날짜는 `repeat` 객체의 `endDate` 속성으로 관리
- 날짜 비교 시 타임존 고려 필요
- 종료 날짜 검증은 클라이언트 측에서 수행 (빠른 피드백)
- 반복 일정 생성 로직에서 `endDate` 또는 `2025-12-31` 중 작은 값 사용

### 테스트 코드 구조 제안
```typescript
describe('FEATURE3: 반복 일정 종료 조건', () => {
  describe('Story 1: 반복 종료 조건 설정', () => {
    it('TC-3-1-1: 반복 유형 선택 시 종료 날짜 입력 필드가 표시된다', ...);
    it('TC-3-1-2: 반복 유형 "반복 안함" 선택 시 종료 날짜 필드가 숨겨진다', ...);
    it('TC-3-1-3: 종료 날짜를 입력하고 저장하면 해당 날짜까지만 반복 일정이 생성된다', ...);
    it('TC-3-1-4: 종료 날짜 미입력 시 기본값(2025-12-31)까지 생성된다', ...);
  });
  
  describe('Story 2: 반복 종료 조건 검증', () => {
    it('TC-3-2-1: 종료 날짜가 시작 날짜보다 이전이면 에러 메시지가 표시된다', ...);
    it('TC-3-2-2: 반복 일정이 종료 날짜 다음날부터는 생성되지 않는다', ...);
    it('TC-3-2-3: 종료 날짜가 2025-12-31을 초과하면 2025-12-31까지만 생성된다', ...);
  });
  
  describe('Story 3: 종료 날짜 수정 및 표시', () => {
    it('TC-3-3-1: 반복 일정 수정 시 기존 종료 날짜가 입력 필드에 표시된다', ...);
    it('TC-3-3-2: 종료 날짜를 수정하면 새로운 종료 날짜가 반영된다', ...);
    it('TC-3-3-3: 일정 목록에서 반복 일정의 종료 날짜 정보가 표시된다', ...);
  });
});
```

---

**테스트 설계 완료일**: 2025-10-30  
**총 테스트 케이스**: 10개 (Story 1: 4개, Story 2: 3개, Story 3: 3개)  
**테스트 유형**: 통합 테스트 10개
